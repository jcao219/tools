cs3110-cli
==========

Command line tools for cs3110, staff edition.
The solution for compiling, testing, and running your code.

Dependencies
============

* `colordiff`, used to make prettier diffs. See the FAQ.
* `enscript`, used to generate .ps output
* `mutt`, used to send emails

Writing Tests
=============

There are a few rules about writing tests for the harness.

* Unit test names may not contain whitespace. So, the unit test `TEST_UNIT "my fave test" = ...` would cause problems with the harness.
* The test for `file.ml` should be called `file_test.ml`. Otherwise postscript can't be generated easily.

FAQ
===

Q. How do I set a timeout on a test?
------------------------------------

Wrap the call in the `Assertions.timeout` wrapper, from the `Assertions` library, which is linked to every executable generated by `cs3110-staff compile`.
This function is documented in `assertions.mli`.

Q. How do I download files from CMS?
------------------------------------

1. Navigate to the course page on CMS
2. In the sidebar, select the "groups" page for the assignment you want files for.
3. Click "All", the red word in the top-center of the page. This selects all students in the table that fills the rest of the page.
4. Click "Files", the grey button at the top-right of the page.
5. Select a download location and unzip the result. Party!

Q. How do I get colored diff output?
------------------------------------

Install `colordiff`.
Once installed, the harness should notice the software and use it instead of regular, black-and-white diff.

Additionally, we recommend changing the default color scheme.
Execute this command and restart the terminal to see colors that match github's scheme: new text in green and deleted text in red.

    echo "newtext=green\noldtext=red\ndiffstuff=cyan" >> ~/.colordiffrc

Q. Got error: 'unrecognized redirect'
-------------------------------------
If you see the error "unrecognized redirect" when running tests, it's likely a problem with the shell OCaml is using to execute Sys commands.
The default on the VM appears to be one `sh` which does not support commands like `echo 'hi' 2 >& 1 > /dev/null`.
A quick fix is to change your `sh` executable to point to bash (i.e. `export shlink=\`which sh\`; rm $shlink; ln -s \`which bash\` $shlink;`).
In the future, the VM should have a new default shell and this won't be an issue!

Q. Students submitted tests for a problem set. How do I test whether their tests were comprehensive?
----------------------------------------------------------------------------------------------------

Currently, you can't.
But previously, the harness supported a `reverse` command (and corresponding `reverse_rubric`) that attempted to do this.
The idea was:

* Begin with a suite of example implementations. These may be correct or intentionally buggy.
* Create a rubric mapping an implementation to whether it should pass or fail and how many points it is worth.
* Run student tests on these implementations. Use record points based on whether the example passed or failed.

This requires a lot of work on our end to ensure the implementations are correct.
(That was one reason we never used this type of test in practice.)
Anyway, we just want you (dear Future) to know that this once existed in the past.

Credits
=======

Thanks [Arjun Guha](https://github.com/arjunguha/cs691f) at UMass Amherst, [Jane Street](https://github.com/janestreet/pa_ounit), and [OUnit](https://github.com/warrenharris/ounit).
